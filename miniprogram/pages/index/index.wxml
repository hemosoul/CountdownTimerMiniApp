<!--index.wxml-->
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container" style="background: {{backgroundColor}}">
    <!-- 标题区域 -->
    <view class="title">
      <text>{{title || '面试倒计时'}}</text>
      <text class="current-date">{{currentDate}}</text>
    </view>
    
    <!-- 倒计时显示区域 -->
    <movable-area class="countdown-area" style="height: 100%; width: 100%;">
      <movable-view 
        class="countdown-container"
        direction="all"
        inertia="true"
        x="{{positionX}}"
        y="{{positionY}}"
        bindchange="onMove"
        style="transform: translate(-50%, -50%);"
      >
        <view class="time-block">
          <view class="flip-card">
            <text>{{hours}}</text>
          </view>
          <text class="time-label">小时</text>
        </view>
        <view class="time-separator">:</view>
        <view class="time-block">
          <view class="flip-card">
            <text>{{minutes}}</text>
          </view>
          <text class="time-label">分钟</text>
        </view>
        <view class="time-separator">:</view>
        <view class="time-block">
          <view class="flip-card">
            <text>{{seconds}}</text>
          </view>
          <text class="time-label">秒</text>
        </view>
      </movable-view>
    </movable-area>

    <!-- 控制按钮区域 -->
    <view class="controls">
      <view class="control-btn" bindtap="toggleDrawer">
        <image 
          src="/resource/icon/setting.svg" 
          mode="aspectFit"
          style="width: 32px; height: 32px;"
        />
      </view>
    </view>

    <!-- 抽屉容器 -->
    <view class="drawer-container {{drawerVisible ? 'show' : ''}}" data-weui-theme="dark">
      <view class="drawer-mask" bindtap="toggleDrawer"></view>
      <view class="drawer-content weui-cells">
        <!-- 头部使用WeUI的单元格样式 -->
        <view class="weui-cell drawer-header">
          <view class="weui-cell__bd">
            <text class="weui-cell__title">设置</text>
          </view>
          <view class="weui-cell__ft">
            <view class="weui-btn_icon-circle-close" bindtap="toggleDrawer"></view>
          </view>
        </view>

        <!-- 倒计时设置使用WeUI表单结构 -->
        <view class="weui-cell weui-cell_input">
          <view class="weui-cell__hd">
            <text class="weui-label">目标时间</text>
          </view>
          <view class="weui-cell__bd">
            <view class="weui-flex custom-time-inputs">
              <view class="weui-flex__item">
                <view class="weui-input-wrapper weui-input-wrapper--inline">
                  <input class="weui-input" 
                         type="number" 
                         placeholder="0"
                         min="0" 
                         max="23"
                         value="{{targetHours}}"
                         bindinput="onHoursChange"/>
                  <view class="weui-input-extra">时</view>
                </view>
              </view>
              <view class="weui-flex__item">
                <view class="weui-input-wrapper weui-input-wrapper--inline">
                  <input class="weui-input" 
                         type="number"
                         placeholder="0"
                         min="0" 
                         max="59"
                         value="{{targetMinutes}}"
                         bindinput="onMinutesChange"/>
                  <view class="weui-input-extra">分</view>
                </view>
              </view>
              <view class="weui-flex__item">
                <view class="weui-input-wrapper weui-input-wrapper--inline">
                  <input class="weui-input" 
                         type="number"
                         placeholder="0"
                         min="0" 
                         max="59"
                         value="{{targetSeconds}}"
                         bindinput="onSecondsChange"/>
                  <view class="weui-input-extra">秒</view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- 提醒设置使用WeUI输入样式 -->
        <view class="weui-cell weui-cell_input">
          <view class="weui-cell__hd">
            <text class="weui-label">提前提醒</text>
          </view>
          <view class="weui-cell__bd">
            <view class="weui-flex custom-time-inputs">
              <view class="weui-flex__item">
                <view class="weui-input-wrapper weui-input-wrapper--inline">
                  <input class="weui-input" 
                         type="number"
                         placeholder="0"
                         min="0" 
                         max="60"
                         value="{{remindBefore}}"
                         bindinput="onRemindChange"/>
                  <view class="weui-input-extra">秒</view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- 背景类型选择使用WeUI分段器 -->
        <view class="weui-cell">
          <view class="weui-cell__hd">
            <text class="weui-label">背景类型</text>
          </view>
          <view class="weui-cell__bd">
            <view class="weui-segmented-control">
              <block wx:for="{{['color', 'image']}}" wx:key="*this">
                <view class="weui-segmented-control__item {{bgType === item ? 'weui-segmented-control__item_active' : ''}}"
                      bindtap="setBgType" data-type="{{item}}">
                  {{item === 'color' ? '颜色' : '图片'}}
                </view>
              </block>
            </view>
          </view>
        </view>

        <!-- 颜色选择器使用WeUI网格布局 -->
        <view class="weui-cell" wx:if="{{bgType === 'color'}}">
          <view class="weui-cell__hd">
            <text class="weui-label">选择颜色</text>
          </view>
          <view class="weui-cell__bd">
            <view class="weui-grids">
              <block wx:for="{{presetColors}}" wx:key="index">
                <view class="weui-grid {{backgroundColor === item ? 'weui-grid_active' : ''}}"
                      style="background:{{item}}"
                      bindtap="selectColor" data-color="{{item}}">
                </view>
              </block>
            </view>
          </view>
        </view>

        <!-- 图片上传使用WeUI按钮样式 -->
        <view class="weui-cell" wx:if="{{bgType === 'image'}}">
          <view class="weui-cell__bd">
            <button class="weui-btn weui-btn_primary" 
                    bindtap="chooseImage">
              {{backgroundImage ? '更换背景' : '选择图片'}}
            </button>
          </view>
        </view>

        <!-- 保存按钮使用WeUI主按钮样式 -->
        <view class="weui-btn-area">
          <button class="weui-btn weui-btn_primary" 
                  bindtap="saveSettings">保存设置</button>
        </view>
      </view>
    </view>
  </view>
</scroll-view>
